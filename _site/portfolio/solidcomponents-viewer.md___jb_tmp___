<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>SolidComponents™ Online CAD Viewer &#8211; xeolabs</title>
<meta name="description" content="Built the online 3D CAD viewer for the <b>SolidComponents™</b> product catalog.">
<meta name="keywords" content="webgl, 3DXML, SolidWorks, CAD, xeogl">
<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="SolidComponents™ Online CAD Viewer">
<meta name="twitter:description" content="Built the online 3D CAD viewer for the <b>SolidComponents™</b> product catalog.">
<meta name="twitter:creator" content="@xeographics">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="SolidComponents™ Online CAD Viewer">
<meta property="og:description" content="Built the online 3D CAD viewer for the <b>SolidComponents™</b> product catalog.">
<meta property="og:url" content="/portfolio/solidcomponents-viewer">
<meta property="og:site_name" content="xeolabs">





<link rel="canonical" href="/portfolio/solidcomponents-viewer">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="xeolabs Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="/assets/css/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon-32x32.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="article" itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">xeolabs</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="/index" >Home</a></li>
		        
				<li><a href="/articles" >Articles</a></li>
		        
				<li><a href="/portfolio" >Portfolio</a></li>
		        
				<li><a href="http://linkedin.com/in/lindsaystanleykay" target="_blank">Resume</a></li>
		        
				<li><a href="/index" >Contact</a></li>
		        
				<li><a href="http://xeogl.org" target="_blank">xeogl</a></li>
		        

		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <div class="article-author-top">
    <img src="/images/avatar.jpg" class="bio-photo" alt="xeolabs bio photo"></a>
<h3><a href="/about/">xeolabs</a></h3>
<p><b>Lindsay Kay</b><br><br><i>3D software engineer / WebGL developer</i></p>
<a href="http://twitter.com/xeographics" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://linkedin.com/in/lindsaystanleykay" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="http://github.com/xeolabs" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>
<br>
<hr>
<p style="text-align: center;"><a href="/pdfs/OpenGLInsights.pdf"><img style="text-align: center; width: 80%;" src="/images/scenejs/OpenGLInsights2.jpg"></a><br>
    <i>My chapter on <a href="http://scenejs.org">SceneJS</a> for OpenGL Insights is now <a href="/pdfs/OpenGLInsights.pdf">free to download!</a></i></p>

  </div>
  <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
    <div class="headline-wrap">
      <h1 itemprop="name">SolidComponents™ Online CAD Viewer</h1>
        <p style="font-weight:bold; font-style:italic;"><time datetime="2018-06-11T00:00:00+00:00" itemprop="datePublished">June 11, 2018</time></p>
    </div><!--/ .headline-wrap -->
    <div class="article-wrap" itemprop="text">
      In 2018, I built a Web-based 3D viewer that would allow visitors to their online catalog to interactively view 
        a 3D model of each product.

 ![](/images/gear.gif)
 
## The Client

**[SolidComponents™](https://www.solidcomponents.com)** is a market leader for Web-based CAD support, based in Halmstad, Sweden. 

They provide an online components catalog system....

## Requirements
 
- Create a WebGL-based viewer for users to interactively view 3D CAD models of products from the client's online catalog
- Load models exported from **[SolidWorks](https://www.solidworks.com/)**
- Realistic, physically-based materials
- Wireframe and transparent viewing modes
- Flexible integration into the catalog page 

<!-- SolidComponents had already made some experimental viewers on THREE.js to load STL and OBJ files exported from SolidWorks, but  -->
<!-- was having difficulty getting the final appearance of the models right using those file formats. -->
 <!-- <br><br>One of the the trickiest things  -->
<!-- was correctly smooth shading the models, since the face-aligned STL normals are useless for smooth shading, and the  -->
<!-- vertex-aligned OBJ normals often caused hard edges to appear incorrectly smooth.   -->

## Solution

I implemented the SolidComponents CAD viewer as a wrapper class around **[xeogl](http://xeogl.org)**, an open source 
WebGL library I created for 3D visualization.
<br><br>
![](/images/solidcomponents/uml.png)

#### 3DXML

I chose **[3DXML](https://en.wikipedia.org/wiki/3DXML)** as the viewer's file format, since it's the native SolidWorks format and represents the model exactly 
as it appears in SolidWorks.

#### Wireframe

For wireframe views, I'm relying on xeogl to auto-generate wireframe meshes from 3DXML's triangle meshes. For each geometry, 
xeogl creates a secondary mesh that contains the edges between adjacent triangles whose surface normals deviate from each other 
by a given threshold, ie. the "hard" edges. This technique eliminates the "inner" edges, which are edges shared by triangles 
that are part of the same faces. 

![](/images/solidcomponents/innerEdges.png) | ![](/images/solidcomponents/innerEdgesRemoved.png)
----|----
Wireframe with inner edges | Inner edges eliminated


#### STL models

Initially, I experimented with loading the **[STL](https://en.wikipedia.org/wiki/STL_(file_format))** format, which is also exported by SolidWorks.
<br><br>
![](/images/solidcomponents/gearWhiteBG.png)

Triangles in STL are disjoint, where each triangle has its own separate vertex positions, normals and 
(optionally) colors. This means that you can have gaps between triangles. Normals for each triangle are perpendicular to the triangle's surface, which gives the model a 
faceted appearance by default. The smoothNormals flag causes the STLModel to recalculate its normals, so that each normal's 
direction is the average of the orientations of the triangles adjacent to its vertex. When smoothing, each vertex normal 
is set to the average of the orientations of all other triangles that have a vertex at the same position, excluding those 
triangles whose direction deviates from the direction of the vertice's triangle by a threshold given in smoothNormalsAngleThreshold. 
This makes smoothing robust for hard edges. 


Normals in STL are face-aligned for a 
flat-shaded appearance, so I ignored them and relied on xeogl to auto-generate them per-vertex. To handle hard edges 
correctly, I extended xeogl's auto-generation to

#### OBJ Models

The client had previously made an experimental viewer on THREE.js that loaded OBJ exported by SolidWorks. However, OBJ contained 
vertex normals that rendered every edge as smooth-shaded, even when it was "hard" and should have rendered with a 
crease.
<br><br>
  

The viewer loads **3DXML** models exported by SolidWorks. 
<br><br>
Initially, I experimented with loading STL models    

### First Attempt: Import STL

My first attempt involved making a loader for STL models. 

- First attempt by importing STL using this shading algorithm
- Smoothing algorithm:  
Triangles in STL are disjoint, where each triangle has its own separate vertex positions, normals and (optionally) colors. 
This means that you can have gaps between triangles. Normals for each triangle are perpendicular to the triangle's surface, 
which gives the model a faceted appearance by default. The smoothNormals flag causes the STLModel to recalculate its normals, 
so that each normal's direction is the average of the orientations of the triangles adjacent to its vertex. When smoothing, 
each vertex normal is set to the average of the orientations of all other triangles that have a vertex at the same position, 
excluding those triangles whose direction deviates from the direction of the vertice's triangle by a threshold given in 
smoothNormalsAngleThreshold. This makes smoothing robust for hard edges.

- Differentiate objects on vertex colors
- STL materials were not expressive enough
- Not possible to preserve colors as modeled in  SolidWworks
- STLModel them open sourced as part of xeogl extras

### Second Attempt: Import 3DXML

# OBJ

- not expressive enough

#glTF

- export plugin available from SIMLab, but not core part of SolidWworks, so not enough control.

# Second attempt: loading 3DXML

- 3DXML is native SolidWorks format
- Built a custom component that extends the xeogl native xeogl.Model component to parse 3DXML 4.2 & 4.3 schema
- Smothing with hard edges supported in 3DXML,  where hard edges lie between  separate meshes with smooth per-vertex normals
- Edges and Wireframe representations required 
- Solidworks 2017 export had an edges representation bundled with models
- SolidWorks 2010 export had no edges representation
- xeogl has baked-in solution, automatically generating wireframe views using ghost and highlight materials
- xeogl  CameraControl has all required interaction



<section id="table-of-contents" class="toc">
  <header>
    <h3>Contents</h3>
  </header>
<div id="drawer" markdown="1">
*  Auto generated table of contents
{:toc}
</div>
</section><!-- /#table-of-contents -->



      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          <img src="/images/avatar.jpg" class="bio-photo" alt="xeolabs bio photo"></a>
<h3><a href="/about/">xeolabs</a></h3>
<p><b>Lindsay Kay</b><br><br><i>3D software engineer / WebGL developer</i></p>
<a href="http://twitter.com/xeographics" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://linkedin.com/in/lindsaystanleykay" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="http://github.com/xeolabs" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>
<br>
<hr>
<p style="text-align: center;"><a href="/pdfs/OpenGLInsights.pdf"><img style="text-align: center; width: 80%;" src="/images/scenejs/OpenGLInsights2.jpg"></a><br>
    <i>My chapter on <a href="http://scenejs.org">SceneJS</a> for OpenGL Insights is now <a href="/pdfs/OpenGLInsights.pdf">free to download!</a></i></p>

        </div>
        <p class="byline"><strong>SolidComponents™ Online CAD Viewer</strong> was published on <time datetime="2018-06-11T00:00:00+00:00" itemprop="datePublished">June 11, 2018</time> and last modified on <time datetime="2018-07-31" itemprop="dateModified">July 31, 2018</time> by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name"><a href="/about" title="About xeolabs" itemprop="url">xeolabs</a></span></span>.</p>
      </footer>

        <!---->
        <!--<br><br>-->
        <!--<div id="disqus_thread"></div>-->
        <!--<script type="text/javascript">-->
            <!--/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */-->
            <!--var disqus_shortname = 'xeographics'; // required: replace example with your forum shortname-->

            <!--/* * * DON'T EDIT BELOW THIS LINE * * */-->
            <!--(function() {-->
                <!--var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;-->
                <!--dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';-->
                <!--(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);-->
            <!--})();-->
        <!--</script>-->
        <!--<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->
        <!--<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>-->
        <!---->
    </div><!-- /.article-wrap -->
  </article>

</div><!-- /#main -->


<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/articles">View all articles</a>)</small></h4>
    <ul>
    
      
      
      
      <li><a href="/portfolio/solidcomponents-viewer" title="SolidComponents™ Online CAD Viewer">SolidComponents™ Online CAD Viewer</a></li>
      
    
      
      
      
      <li><a href="/portfolio/biodigital-human" title="The BioDigital Human™">The BioDigital Human™</a></li>
      
    
      
      
      
      <li><a href="/portfolio/bimdata" title="BIMData™ Online BIM Viewer">BIMData™ Online BIM Viewer</a></li>
      
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    <span>&copy; 2018 xeolabs. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
<script src="/assets/js/vendor/jquery-1.9.1.min.js"></script>
<script src="/assets/js/vendor/jquery.gifplayer.js"></script>
<link rel="stylesheet" href="/assets/css/gifplayer.css" />
<!--<script src="/assets/js/scripts.min.js"></script>-->


<script>
    $(document).ready( function(){
        $('.gifplayer').gifplayer();
    });
</script>



</body>
</html>
