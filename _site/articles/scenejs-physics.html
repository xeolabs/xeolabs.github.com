<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Rigid-Body Physics in SceneJS &#8211; xeolabs</title>
<meta name="description" content="Creating rigid-body physical simulations">
<meta name="keywords" content="scenejs, tutorial, physics, simulation">
<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xeolabs.com/images/">
<meta name="twitter:title" content="Rigid-Body Physics in SceneJS">
<meta name="twitter:description" content="Creating rigid-body physical simulations">
<meta name="twitter:creator" content="@xeolabs">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Rigid-Body Physics in SceneJS">
<meta property="og:description" content="Creating rigid-body physical simulations">
<meta property="og:url" content="http://xeolabs.com/articles/scenejs-physics">
<meta property="og:site_name" content="xeolabs">





<link rel="canonical" href="http://xeolabs.com/articles/scenejs-physics">
<link href="http://xeolabs.com/feed.xml" type="application/atom+xml" rel="alternate" title="xeolabs Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="http://xeolabs.com/assets/css/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="http://xeolabs.com/assets/css/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://xeolabs.com/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://xeolabs.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://xeolabs.com/favicon-32x32.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://xeolabs.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://xeolabs.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://xeolabs.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://xeolabs.com/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="article" itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://xeolabs.com/">xeolabs</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="http://xeolabs.com/index" >About</a></li>
		        
				<li><a href="http://xeolabs.com/articles" >Blog</a></li>
		        
				<li><a href="http://xeolabs.com/portfolio" >Portfolio</a></li>
		        
				<li><a href="http://xeolabs.com/pdfs/lindsaykay_resume_2019.pdf" >Resume</a></li>
		        
				<li><a href="http://linkedin.com/in/lindsaystanleykay" target="_blank">LinkedIn</a></li>
		        
				<li><a href="http://xeolabs.com/contact" >Contact</a></li>
		        
				<li><a href="http://xeogl.org" target="_blank">xeogl</a></li>
		        
				<li><a href="http://xeokit.io" target="_blank">xeokit</a></li>
		        

		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <div class="article-author-top">
    <img src="http://xeolabs.com/images/avatar.jpg" class="bio-photo" alt="xeolabs bio photo"></a>
<h3><a href="http://xeolabs.com/about/">xeolabs</a></h3>
<p><b>Lindsay Kay</b><br><br><i>3D software engineer / WebGL developer</i></p>
<a href="http://twitter.com/xeolabs" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://linkedin.com/in/lindsaystanleykay" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="http://github.com/xeolabs" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>
<br>
<hr>
<p style="text-align: center;"><a href="http://xeolabs.com/pdfs/OpenGLInsights.pdf"><img style="text-align: center; width: 80%;" src="http://xeolabs.com/images/scenejs/OpenGLInsights2.jpg"></a><br>
    <i>My chapter on <a href="http://scenejs.org">SceneJS</a> for OpenGL Insights is now <a href="http://xeolabs.com/pdfs/OpenGLInsights.pdf">free to download!</a></i></p>

  </div>
  <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
    <div class="headline-wrap">
      <h1 itemprop="name">Rigid-Body Physics in SceneJS</h1>
        <p style="font-weight:bold; font-style:italic;"><time datetime="2013-10-28T00:00:00+00:00" itemprop="datePublished">October 28, 2013</time></p>
    </div><!--/ .headline-wrap -->
    <div class="article-wrap" itemprop="text">
      <section id="table-of-contents" class="toc">
  <header>
    <h3>Contents</h3>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li><a href="#creating-a-physics-body" id="markdown-toc-creating-a-physics-body">Creating a physics body</a>    <ul>
      <li><a href="#box-shaped-body" id="markdown-toc-box-shaped-body">Box-shaped body</a></li>
      <li><a href="#sphere-shaped-body" id="markdown-toc-sphere-shaped-body">Sphere-shaped body</a></li>
      <li><a href="#plane-shaped-body" id="markdown-toc-plane-shaped-body">Plane-shaped body</a></li>
    </ul>
  </li>
  <li><a href="#body-extents" id="markdown-toc-body-extents">Body extents</a></li>
  <li><a href="#physics-materials" id="markdown-toc-physics-materials">Physics materials</a></li>
  <li><a href="#configuring-a-physics-system" id="markdown-toc-configuring-a-physics-system">Configuring a physics system</a></li>
  <li><a href="#physics-primitives" id="markdown-toc-physics-primitives">Physics primitives</a>    <ul>
      <li><a href="#teapot-primitive" id="markdown-toc-teapot-primitive">Teapot primitive</a></li>
      <li><a href="#box-primitive" id="markdown-toc-box-primitive">Box primitive</a></li>
      <li><a href="#sphere-primitive" id="markdown-toc-sphere-primitive">Sphere primitive</a></li>
      <li><a href="#plane-primitive" id="markdown-toc-plane-primitive">Plane primitive</a></li>
    </ul>
  </li>
  <li><a href="#switching-physics-engines" id="markdown-toc-switching-physics-engines">Switching physics engines</a></li>
  <li><a href="#roadmap" id="markdown-toc-roadmap">Roadmap</a></li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->

<table>
  <thead>
    <tr>
      <th><a href="http://scenejs.org/examples.html?page=physicsBouncingSpheres"><img src="http://scenejs.org/images/physics100Bodies.png" alt="" /></a></th>
      <th><a href="http://scenejs.org/examples.html?page=physicsBouncingSpheresMultiSystems"><img src="http://scenejs.org/images/physics400Bodies.png" alt="" /></a></th>
      <th><a href="http://scenejs.org/examples.html?page=physicsBouncingBoxes"><img src="http://scenejs.org/images/physicsBoxes.png" alt="" /></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>100 bodies in a single system - <a href="http://scenejs.org/examples.html?page=physicsBouncingSpheres">Run demo</a></td>
      <td>400 bodies in four systems - <a href="http://scenejs.org/examples.html?page=physicsBouncingSpheres">Run demo</a></td>
      <td>30 Falling boxes - <a href="http://scenejs.org/examples.html?page=physicsBouncingBoxes">Run demo</a></td>
    </tr>
  </tbody>
</table>

<h1 id="overview">Overview</h1>
<p>SceneJS supports rigid-body physics through a collection of special node types which may be inserted into scene graphs to define physical behaviours (ie. coordinate system transformations) for child nodes. Physical simulations may be run across multiple systems, with each system running within an engine on a separate worker thread. This means that when one physics system is overloaded, it will not starve the rendering thread and other physics systems. The physics engines are pluggable - they are <a href="https://github.com/supereggbert/JigLibJS">JigLibJS</a> by default, but may be easily replaced with alternatives such as <a href="https://github.com/kripken/ammo.js">AmmoJS</a>, <a href="http://schteppe.github.io/cannon.js/">CannonJS</a>, or even with a proxy to a high-performance server-based engine.</p>

<p><img src="http://scenejs.org/images/physics.png" alt="" /></p>

<h1 id="creating-a-physics-body">Creating a physics body</h1>

<p>A <code>physics/body</code> node creates a body in a physics system and causes its child nodes to translate and rotate  according to the body’s movements and interactions with other bodies.
The <code>shape</code> parameter on this node specifies the shape of the body boundary. We’ll describe the different shapes that are available, starting with the <code>box</code> shape, with which we’ll introduce the general parameters of the node. Then we’ll describe the other shape types, describing only the parameters specific to each of those shape types.</p>

<h2 id="box-shaped-body">Box-shaped body</h2>

<p>Example:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">someNode</span><span class="p">.</span><span class="nx">addNode</span><span class="p">({</span>
   <span class="na">type</span><span class="p">:</span> <span class="s2">"physics/body"</span><span class="p">,</span>

   <span class="c1">// This optional "systemId" param selects which system to create body in,</span>
   <span class="c1">// allowing multiple systems per scene.  The system is created if not yet</span>
   <span class="c1">// existing. The body is created in the nameless default system when this</span>
   <span class="c1">// param is omitted.</span>
   <span class="na">systemId</span><span class="p">:</span> <span class="s2">"mySystem"</span><span class="p">,</span>

   <span class="c1">// Available shapes are "box", "sphere", "plane" etc.</span>
   <span class="na">shape</span><span class="p">:</span> <span class="s2">"box"</span><span class="p">,</span>

   <span class="c1">// Center of body</span>
   <span class="na">pos</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>

   <span class="c1">// Dimension parameters will be shape-specific</span>
   <span class="na">size</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>

   <span class="c1">// Mass</span>
   <span class="na">mass</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>

   <span class="c1">// The coefficient of restitution (COR) of two colliding objects is a</span>
   <span class="c1">// fractional value representing the ratio of speeds after and before</span>
   <span class="c1">// an impact, taken along the line of the impact.</span>
   <span class="na">restitution</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>

   <span class="c1">// Friction</span>
   <span class="na">friction</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>

   <span class="c1">// Velocity vector</span>
   <span class="na">velocity</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">],</span>

   <span class="c1">// Specify whether or not this body is able to move</span>
   <span class="c1">// Unmoving bodies would be things like walls and floors</span>
   <span class="na">movable</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>

   <span class="c1">// Child nodes</span>
   <span class="na">nodes</span><span class="p">:</span> <span class="p">[</span>

      <span class="c1">// Child nodes can be anything, but must fit within the dimensions</span>
      <span class="c1">// of the physics body. In this case, we have a child box primitive,</span>
      <span class="c1">// implemented by the plugin at</span>
      <span class="c1">// http://scenejs.org/api/latest/plugins/node/geometry/box.js</span>
      <span class="p">{</span>
         <span class="na">type</span><span class="p">:</span> <span class="s2">"geometry/box"</span><span class="p">,</span>
         <span class="na">size</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li>There is one default physics system per scene</li>
  <li>Each system has its own physics engine (eg. JigLibJS) that runs in its own Web worker</li>
  <li>Using an optional <code>systemId</code> property on the <code>physics/body</code> node, multiple physics systems may be created per scene</li>
  <li>Note that vectors (size, pos, velocity) on the <code>physics/body</code> and <code>geometry/box</code>` are arrays - we’re deprecating object formats for those sort of params.</li>
  <li><a href="http://scenejs.org/api/latest/plugins/node/physics/body.js"><code>physics/body</code> node implementation</a></li>
</ul>

<h2 id="sphere-shaped-body">Sphere-shaped body</h2>

<p>Example:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">someNode</span><span class="p">.</span><span class="nx">addNode</span><span class="p">({</span>
   <span class="na">type</span><span class="p">:</span> <span class="s2">"physics/body"</span><span class="p">,</span>

   <span class="c1">// Optional physics system ID - fall back on scene's default system</span>
   <span class="na">systemId</span><span class="p">:</span> <span class="s2">"mySystem"</span><span class="p">,</span>

   <span class="c1">// Spherical body shape</span>
   <span class="na">shape</span><span class="p">:</span> <span class="s2">"sphere"</span><span class="p">,</span>

   <span class="c1">// Center of body</span>
   <span class="na">pos</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>

   <span class="c1">// Sphere radius</span>
   <span class="na">radius</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>

   <span class="c1">// Mass</span>
   <span class="na">mass</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>

   <span class="c1">// The coefficient of restitution</span>
   <span class="na">restitution</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>

   <span class="c1">// Friction</span>
   <span class="na">friction</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>

   <span class="c1">// Velocity vector</span>
   <span class="na">velocity</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">],</span>

   <span class="c1">// Body is moving</span>
   <span class="na">movable</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>

   <span class="c1">// Child nodes</span>
   <span class="na">nodes</span><span class="p">:</span> <span class="p">[</span>

      <span class="c1">// Child sphere primitive, implemented by the plugin at</span>
      <span class="c1">// http://scenejs.org/api/latest/plugins/node/geometry/sphere.js</span>
      <span class="p">{</span>
         <span class="na">type</span><span class="p">:</span> <span class="s2">"geometry/sphere"</span><span class="p">,</span>
         <span class="na">radius</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">});</span></code></pre></figure>

<h2 id="plane-shaped-body">Plane-shaped body</h2>

<p>Example:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">someNode</span><span class="p">.</span><span class="nx">addNode</span><span class="p">({</span>
   <span class="na">type</span><span class="p">:</span> <span class="s2">"physics/body"</span><span class="p">,</span>

   <span class="c1">// Optional physics system ID - fall back on scene's default system</span>
   <span class="na">systemId</span><span class="p">:</span> <span class="s2">"mySystem"</span><span class="p">,</span>

   <span class="c1">// Planar body shape</span>
   <span class="na">shape</span><span class="p">:</span> <span class="s2">"plane"</span><span class="p">,</span>

   <span class="c1">// Position</span>
   <span class="na">pos</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

   <span class="c1">// Points upwards</span>
   <span class="na">dir</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

   <span class="c1">// Let's make it stationary</span>
   <span class="na">velocity</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

   <span class="c1">// Mass not relevant for unmoving object</span>
   <span class="na">mass</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>

   <span class="c1">// The coefficient of restitution</span>
   <span class="na">restitution</span><span class="p">:</span><span class="mf">0.9</span><span class="p">,</span>

   <span class="na">friction</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span>

   <span class="c1">// Let's make it stationary</span>
   <span class="na">movable</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>

   <span class="c1">// Child nodes</span>
   <span class="na">nodes</span><span class="p">:[</span>

        <span class="c1">// Blue color for ground plane</span>
        <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span><span class="s2">"material"</span><span class="p">,</span>
            <span class="na">color</span><span class="p">:{</span> <span class="na">r</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span> <span class="na">g</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span><span class="mf">1.0</span> <span class="p">},</span>
            <span class="na">nodes</span><span class="p">:[</span>

                <span class="c1">// Grid ground plane geometry, implemented by plugin at</span>
                <span class="c1">// http://scenejs.org/api/latest/plugins/node/geometry/grid.js</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span><span class="s2">"geometry/grid"</span><span class="p">,</span>
                    <span class="na">size</span><span class="p">:{</span> <span class="na">x</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span> <span class="na">z</span><span class="p">:</span><span class="mi">1000</span> <span class="p">},</span>
                    <span class="na">xSegments</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                    <span class="na">zSegments</span><span class="p">:</span><span class="mi">200</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">});</span></code></pre></figure>

<p>More body types coming up.</p>

<h1 id="body-extents">Body extents</h1>
<p>You must ensure that the extents of the <code>physics/body</code> enclose the space occupied by its child nodes. Ideally, we would do that automatically, expanding and contracting the extents as child nodes are added and removed.</p>

<p>However, the reasons we don’t (re)calculated them automatically are:
* It’s complex, where there are too many cases to consider (at least at this stage), and we need to keep the JavaScript simple
* The child nodes might be moving, and thus the boundary would be specified for the extents of their movement, (which again, could be hard to compute in advance, or synchronise the body extents with)
* Whatever creates the <code>physics/body</code> node (eg. a loader, or another custom node type) is likely to be in a position of calculate the extents of child nodes anyway</p>

<h1 id="physics-materials">Physics materials</h1>
<p>Although you can specify properties like <code>restitution</code>, <code>friction</code> and <code>mass</code> on individual <code>physics/body</code> nodes, sometimes you’ll want to share those properties among a group of <code>physics/body</code> nodes.</p>

<p>Just as we can have a parent <code>material</code> node wrapping multiple child <code>geometry</code> nodes, we can have a <code>physics/material</code> node wrapping multiple child <code>physics/body</code> nodes, so that the children inherit properties from the parent:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">someNode</span><span class="p">.</span><span class="nx">addNode</span><span class="p">({</span>
   <span class="na">type</span><span class="p">:</span> <span class="s2">"physics/material"</span><span class="p">,</span>

   <span class="na">mass</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>
   <span class="na">restitution</span><span class="p">:</span><span class="mf">0.9</span><span class="p">,</span>
   <span class="na">friction</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span>

   <span class="na">nodes</span><span class="p">:</span> <span class="p">[</span>
       <span class="p">{</span>
           <span class="na">type</span><span class="p">:</span> <span class="s2">"physics/body"</span><span class="p">,</span>
           <span class="na">shape</span><span class="p">:</span> <span class="s2">"plane"</span><span class="p">,</span>
           <span class="c1">//...</span>
       <span class="p">},</span>
       <span class="p">{</span>
           <span class="na">type</span><span class="p">:</span> <span class="s2">"physics/body"</span><span class="p">,</span>
           <span class="na">shape</span><span class="p">:</span> <span class="s2">"sphere"</span><span class="p">,</span>
           <span class="c1">//...</span>
       <span class="p">},</span>
       <span class="c1">//...</span>
    <span class="p">]</span>
<span class="p">});</span></code></pre></figure>

<p>Note that spatial properties like <code>pos</code>, <code>dir</code>, <code>velocity</code> etc. are not supported on a <code>physics/material</code> node, because those only make sense on an actual physical body.</p>

<ul>
  <li><a href="http://scenejs.org/api/latest/plugins/node/physics/material.js"><code>physics/material</code> node implementation</a></li>
</ul>

<h1 id="configuring-a-physics-system">Configuring a physics system</h1>

<p>The <code>physics/system</code> node configures a physics system and may appear anywhere within the scene graph.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">physicsSystem</span> <span class="o">=</span> <span class="nx">someNode</span><span class="p">.</span><span class="nx">addNode</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="s2">"physics/system"</span><span class="p">,</span>
      <span class="na">systemId</span><span class="p">:</span> <span class="s2">"mySystem"</span><span class="p">,</span>  <span class="c1">// Optional - selects scene's default system when absent</span>
      <span class="na">gravity</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
      <span class="na">solver</span><span class="p">:</span><span class="s2">"ACCUMULATED"</span> <span class="c1">// (default) or "FAST", "NORMAL"</span>
<span class="p">})</span></code></pre></figure>

<p>We can reconfigure the system any time:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">physicsSystem</span><span class="p">.</span><span class="nx">setConfigs</span><span class="p">({</span>
     <span class="na">gravity</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
     <span class="na">solver</span><span class="p">:</span><span class="s2">"FAST"</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li>When the <code>systemId</code> is given, the <code>physics/system</code> node will configure that system, creating it first if not existing yet. When <code>systemId</code> is absent, the node will configure the scene’s default physics system.</li>
  <li><code>physics/system</code> nodes are optional - if you create <code>physics/body</code> nodes for a <code>systemId</code> (or the scene’s
 default system) for which no <code>physics/system</code> node exists in the scene, then that system will just use its default configuration.</li>
  <li><a href="http://scenejs.org/api/latest/plugins/node/physics/system.js"><code>physics/system</code> node implementation</a></li>
</ul>

<h1 id="physics-primitives">Physics primitives</h1>

<p>There is a collection of convenience nodes, each of which wraps a child <code>physics/body</code>, which in turn wraps a child geometry primitive node, and configures the extents of the <code>physics/body</code> to enclose the primitive.  These allow you to just create, for example, a teapot with physics behaviours, in one shot:</p>

<h2 id="teapot-primitive">Teapot primitive</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">someNode</span><span class="p">.</span><span class="nx">addNode</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="s2">"physics/teapot"</span><span class="p">,</span>
    <span class="na">pos</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">30.4</span><span class="p">,</span> <span class="mf">234.1</span><span class="p">],</span>
    <span class="na">velocity</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">],</span>
    <span class="na">mass</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="c1">//...</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li><a href="http://scenejs.org/api/latest/plugins/node/physics/teapot.js"><code>physics/teapot</code> node implementation</a></li>
</ul>

<h2 id="box-primitive">Box primitive</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">someNode</span><span class="p">.</span><span class="nx">addNode</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="s2">"physics/box"</span><span class="p">,</span>
    <span class="na">pos</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">30.4</span><span class="p">,</span> <span class="mf">234.1</span><span class="p">],</span>
    <span class="na">velocity</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">],</span>
    <span class="na">size</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>
    <span class="na">mass</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="c1">//...</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li><a href="http://scenejs.org/api/latest/plugins/node/physics/box.js"><code>physics/box</code> node implementation</a></li>
</ul>

<h2 id="sphere-primitive">Sphere primitive</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">someNode</span><span class="p">.</span><span class="nx">addNode</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="s2">"physics/sphere"</span><span class="p">,</span>
    <span class="na">pos</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">30.4</span><span class="p">,</span> <span class="mf">234.1</span><span class="p">],</span>
    <span class="na">velocity</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">],</span>
    <span class="na">radius</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="na">latitudeBands</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="na">longitudeBands</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="na">wire</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">mass</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="c1">//...</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li><a href="http://scenejs.org/api/latest/plugins/node/physics/sphere.js"><code>physics/sphere</code> node implementation</a></li>
</ul>

<h2 id="plane-primitive">Plane primitive</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">someNode</span><span class="p">.</span><span class="nx">addNode</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="s2">"physics/plane"</span><span class="p">,</span>
    <span class="na">pos</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">30.4</span><span class="p">,</span> <span class="mf">234.1</span><span class="p">],</span>
    <span class="na">velocity</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">],</span>
    <span class="na">direction</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="na">width</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="na">height</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="na">widthSegments</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="na">heightSegments</span><span class="p">:</span> <span class="mi">10</span>
    <span class="na">wire</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">mass</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="c1">//...</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li><a href="http://scenejs.org/api/latest/plugins/node/physics/plane.js"><code>physics/plane</code> node implementation</a></li>
</ul>

<p>[More to come..]</p>

<h1 id="switching-physics-engines">Switching physics engines</h1>

<p><strong>In development</strong></p>

<p>JigLibJS is the default physics engine, however other supported engines may be selected with a <code>physicsEngine</code> SceneJS global config. The config will be “jiglibjs” by default, but might also be “cannonjs” or “ammojs” if those are available:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">SceneJS</span><span class="p">,</span><span class="nx">setConfigs</span><span class="p">({</span>
    <span class="na">physicsEngine</span><span class="p">:</span> <span class="s2">"jiglibjs"</span>
<span class="p">});</span></code></pre></figure>

<p>Each supported physics engine will be a RequireJS module  within the plugin support library directory, and will export this interface:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>

     <span class="cm">/** Configure the engine. This can be done at any time.
      * @param configs Key-value map of configs
      */</span>
     <span class="nl">setConfigs</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
     <span class="p">},</span>

     <span class="cm">/** Creates a body in the engine and returns an ID for it
      * @params params Body properties - possibly generic across all engines
      * @params callback Callback which return an updated position and a rotation
      *                            matrix each the body is updated
      * @return ID of the new body
      */</span>
     <span class="nx">createBody</span> <span class="err">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
     <span class="p">};</span>

     <span class="cm">/** Updates physics properties an existing body in the engine. Note this
      * does not change the shape of the phycics body, just things  like mass,
      * restitution, velocity, position etc.
      * @params bodyId Body ID
      * @params params Body properties
      */</span>
     <span class="nl">updateBody</span> <span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">bodyid</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
     <span class="p">},</span>

     <span class="cm">/** Removes a body from the engine
      */</span>
     <span class="nx">removeBody</span> <span class="err">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">bodyId</span><span class="p">)</span> <span class="p">{</span>
     <span class="p">},</span>

      <span class="cm">/**
       * Integrates this physics system
       */</span>
      <span class="nx">integrate</span> <span class="err">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<ul>
  <li><a href="http://scenejs.org/api/latest/plugins/lib/physics/worker.js">Worker implementation for JigLibJS</a></li>
</ul>

<h1 id="roadmap">Roadmap</h1>

<ul>
  <li>Ability to enable or disable physics systems so they don’t keep running when their bodies are culled from the view (ie. by frustum culling etc)</li>
  <li>An engine (pluggable as shown above) that proxies a high-performance server-side physics system (ie. written in C/C++, not JavaScript)</li>
  <li><a href="https://github.com/xeolabs/scenejs/issues?direction=desc&amp;labels=Physics&amp;page=1&amp;sort=created&amp;state=open">Issues tagged ‘physics’</a></li>
</ul>

      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          <img src="http://xeolabs.com/images/avatar.jpg" class="bio-photo" alt="xeolabs bio photo"></a>
<h3><a href="http://xeolabs.com/about/">xeolabs</a></h3>
<p><b>Lindsay Kay</b><br><br><i>3D software engineer / WebGL developer</i></p>
<a href="http://twitter.com/xeolabs" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://linkedin.com/in/lindsaystanleykay" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="http://github.com/xeolabs" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>
<br>
<hr>
<p style="text-align: center;"><a href="http://xeolabs.com/pdfs/OpenGLInsights.pdf"><img style="text-align: center; width: 80%;" src="http://xeolabs.com/images/scenejs/OpenGLInsights2.jpg"></a><br>
    <i>My chapter on <a href="http://scenejs.org">SceneJS</a> for OpenGL Insights is now <a href="http://xeolabs.com/pdfs/OpenGLInsights.pdf">free to download!</a></i></p>

        </div>
        <p class="byline"><strong>Rigid-Body Physics in SceneJS</strong> was published on <time datetime="2013-10-28T00:00:00+00:00" itemprop="datePublished">October 28, 2013</time> and last modified on <time datetime="2013-05-31" itemprop="dateModified">May 31, 2013</time> by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name"><a href="http://xeolabs.com/about" title="About xeolabs" itemprop="url">xeolabs</a></span></span>.</p>
      </footer>

        <!---->
        <!--<br><br>-->
        <!--<div id="disqus_thread"></div>-->
        <!--<script type="text/javascript">-->
            <!--/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */-->
            <!--var disqus_shortname = 'xeographics'; // required: replace example with your forum shortname-->

            <!--/* * * DON'T EDIT BELOW THIS LINE * * */-->
            <!--(function() {-->
                <!--var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;-->
                <!--dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';-->
                <!--(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);-->
            <!--})();-->
        <!--</script>-->
        <!--<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->
        <!--<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>-->
        <!---->
    </div><!-- /.article-wrap -->
  </article>

</div><!-- /#main -->


<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://xeolabs.com/articles">View all articles</a>)</small></h4>
    <ul>
    
      
      
      
    
      
      
      
    
      
      
      
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    <span>&copy; 2019 xeolabs. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
<!--<script src="http://xeolabs.com/assets/js/vendor/jquery-1.9.1.min.js"></script>-->
<!--<script src="http://xeolabs.com/assets/js/vendor/jquery.gifplayer.js"></script>-->
<!--<link rel="stylesheet" href="http://xeolabs.com/assets/css/gifplayer.css" />-->
<!--<script src="http://xeolabs.com/assets/js/scripts.min.js"></script>-->


<!--<script>-->
    <!--$(document).ready( function(){-->
        <!--$('.gifplayer').gifplayer();-->
    <!--});-->
<!--</script>-->



</body>
</html>
