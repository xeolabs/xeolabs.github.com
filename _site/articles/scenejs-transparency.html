<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Transparency in SceneJS &#8211; xeolabs</title>
<meta name="description" content="All about making objects transparent in SceneJS">
<meta name="keywords" content="scenejs, tutorial, transparency">
<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="Transparency in SceneJS">
<meta name="twitter:description" content="All about making objects transparent in SceneJS">
<meta name="twitter:creator" content="@xeographics">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Transparency in SceneJS">
<meta property="og:description" content="All about making objects transparent in SceneJS">
<meta property="og:url" content="/articles/scenejs-transparency">
<meta property="og:site_name" content="xeolabs">





<link rel="canonical" href="/articles/scenejs-transparency">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="xeolabs Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="/assets/css/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon-32x32.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="article" itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">xeolabs</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="/index" >About</a></li>
		        
				<li><a href="/articles" >Articles</a></li>
		        
				<li><a href="/portfolio" >Portfolio</a></li>
		        
				<li><a href="http://linkedin.com/in/lindsaystanleykay" target="_blank">Resume</a></li>
		        
				<li><a href="/index" >Contact</a></li>
		        
				<li><a href="http://xeogl.org" target="_blank">xeogl</a></li>
		        

		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <div class="article-author-top">
    <img src="/images/avatar.jpg" class="bio-photo" alt="xeolabs bio photo"></a>
<h3><a href="/about/">xeolabs</a></h3>
<p><b>Lindsay Kay</b><br><br><i>3D software engineer / WebGL developer</i></p>
<a href="http://twitter.com/xeographics" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://linkedin.com/in/lindsaystanleykay" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="http://github.com/xeolabs" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>
<br>
<hr>
<p style="text-align: center;"><a href="/pdfs/OpenGLInsights.pdf"><img style="text-align: center; width: 80%;" src="/images/scenejs/OpenGLInsights2.jpg"></a><br>
    <i>My chapter on <a href="http://scenejs.org">SceneJS</a> for OpenGL Insights is now <a href="/pdfs/OpenGLInsights.pdf">free to download!</a></i></p>

  </div>
  <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
    <div class="headline-wrap">
      <h1 itemprop="name">Transparency in SceneJS</h1>
        <p style="font-weight:bold; font-style:italic;"><time datetime="2013-11-03T00:00:00+00:00" itemprop="datePublished">November 03, 2013</time></p>
    </div><!--/ .headline-wrap -->
    <div class="article-wrap" itemprop="text">
      <section id="table-of-contents" class="toc">
  <header>
    <h3>Contents</h3>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#making-objects-transparent" id="markdown-toc-making-objects-transparent">Making objects transparent</a>    <ul>
      <li><a href="#switching-transparency-on-and-off" id="markdown-toc-switching-transparency-on-and-off">Switching transparency on and off</a></li>
      <li><a href="#varying-opacity" id="markdown-toc-varying-opacity">Varying opacity</a></li>
      <li><a href="#picking-through-transparent-objects" id="markdown-toc-picking-through-transparent-objects">Picking through transparent objects</a></li>
    </ul>
  </li>
  <li><a href="#transparency-sorting" id="markdown-toc-transparency-sorting">Transparency sorting</a>    <ul>
      <li><a href="#the-problem" id="markdown-toc-the-problem">The problem</a></li>
      <li><a href="#solutions-that-dont-work-so-well-in-webgl" id="markdown-toc-solutions-that-dont-work-so-well-in-webgl">Solutions that don’t work so well in WebGL</a>        <ul>
          <li><a href="#painters-algorithm-or-bsp-nope" id="markdown-toc-painters-algorithm-or-bsp-nope">Painter’s Algorithm or BSP? Nope.</a></li>
          <li><a href="#depth-peeling-nope" id="markdown-toc-depth-peeling-nope">Depth peeling? Nope.</a></li>
        </ul>
      </li>
      <li><a href="#solution-ordered-render-bins" id="markdown-toc-solution-ordered-render-bins">Solution: Ordered render bins</a>        <ul>
          <li><a href="#changing-layer-priorities" id="markdown-toc-changing-layer-priorities">Changing layer priorities</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
  <li><a href="#whats-next" id="markdown-toc-whats-next">What’s next?</a></li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->

<p>In this tutorial I’ll show you how to</p>

<ul>
  <li>make objects transparent,</li>
  <li>switch transparency on and off</li>
  <li>vary the opacity of transparent objects</li>
  <li>pick through transparent objects, to pick objects behind them</li>
  <li>depth-sort transparent objects for correct alpha-blending order</li>
</ul>

<p>When you’ve read this tutorial, you might be interested to read about texturing your
transparency with <a href="/articles/scenejs-alpha-mapping">Alpha Maps</a>.</p>

<p><br /></p>

<h1 id="making-objects-transparent">Making objects transparent</h1>

<p>As usual, we’ll point SceneJS at where you keep your plugins:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">SceneJS</span><span class="p">.</span><span class="nx">setConfigs</span><span class="p">({</span>
     <span class="na">pluginPath</span><span class="p">:</span><span class="s2">"./plugins"</span>
<span class="p">});</span></code></pre></figure>

<p>Then we’ll create the scene below, in which the outer blue box has a transparent material which allows you to see the teapot within it.
<br /><br />
<a href="http://scenejs.org/examples.html?page=basicTransparency"><img src="/images/scenejs/transparentObject.png" alt="Basic transparency" /></a>
<a href="http://scenejs.org/examples.html?page=basicTransparency">Run this demo</a>
<br /><br />
The code for this example is shown below. Our outer blue box is wrapped with a <code class="highlighter-rouge">flags</code> node, which works in conjunction with
a <code class="highlighter-rouge">material</code> node to make it transparent.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">scene</span> <span class="o">=</span> <span class="nx">SceneJS</span><span class="p">.</span><span class="nx">createScene</span><span class="p">({</span>
    <span class="na">nodes</span><span class="p">:[</span>

        <span class="c1">// Set up a nice camera angle</span>
        <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span><span class="s2">"lookAt"</span><span class="p">,</span>
            <span class="na">eye</span><span class="p">:{</span> <span class="na">x</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="na">z</span><span class="p">:</span><span class="mi">10</span> <span class="p">},</span> <span class="na">look</span><span class="p">:{</span> <span class="na">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="na">z</span><span class="p">:</span><span class="mi">0</span> <span class="p">},</span>

            <span class="na">nodes</span><span class="p">:[</span>

                <span class="c1">// Opaque red teapot</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span><span class="s2">"material"</span><span class="p">,</span>
                    <span class="na">color</span><span class="p">:{</span> <span class="na">r</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="na">g</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span><span class="mf">0.3</span> <span class="p">},</span>

                    <span class="na">nodes</span><span class="p">:[</span>
                        <span class="p">{</span>
                            <span class="na">type</span><span class="p">:</span><span class="s2">"geometry/teapot"</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>                     <span class="p">,</span>

                <span class="c1">// Transparent blue box</span>

                <span class="c1">// Flags node enables transparency for our box.</span>
                <span class="c1">// This enables the material `alpha` to specify</span>
                <span class="c1">// the degree of opacity.</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span><span class="s2">"flags"</span><span class="p">,</span>
                    <span class="na">flags</span><span class="p">:{</span> <span class="na">transparent</span><span class="p">:</span><span class="kc">true</span> <span class="p">},</span>

                    <span class="na">nodes</span><span class="p">:[</span>

                        <span class="c1">// Material node's 'alpha' property makes</span>
                        <span class="c1">// teapot 60% transparent.</span>
                        <span class="p">{</span>
                            <span class="na">type</span><span class="p">:</span><span class="s2">"material"</span><span class="p">,</span>
                            <span class="na">color</span><span class="p">:{</span> <span class="na">r</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span> <span class="na">g</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span><span class="mf">1.0</span> <span class="p">},</span>
                            <span class="na">alpha</span><span class="p">:</span><span class="mf">0.4</span><span class="p">,</span>

                            <span class="na">nodes</span><span class="p">:[</span>
                                <span class="p">{</span>
                                    <span class="na">type</span><span class="p">:</span><span class="s2">"translate"</span><span class="p">,</span> <span class="na">x</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="na">z</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="na">nodes</span><span class="p">:[</span>
                                        <span class="p">{</span>
                                            <span class="na">type</span><span class="p">:</span><span class="s2">"geometry/box"</span><span class="p">,</span>
                                            <span class="na">xSize</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="na">ySize</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="na">zSize</span><span class="p">:</span><span class="mi">3</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">});</span></code></pre></figure>

<p>Things to note:</p>

<ul>
  <li>The <code class="highlighter-rouge">transparent</code> flag on the <code class="highlighter-rouge">flags</code> node around the outer blue box which enables it to be transparent.</li>
  <li>The <code class="highlighter-rouge">material</code> node around the blue box has an <code class="highlighter-rouge">alpha</code> of <code class="highlighter-rouge">0.4</code>, which works in conjuction with the <code class="highlighter-rouge">flags</code> node to
make the box 60% transparent.</li>
  <li>The box would be invisible if <code class="highlighter-rouge">alpha</code> was 0.0, and opaque if <code class="highlighter-rouge">alpha</code> was 1.0.</li>
</ul>

<p>SceneJS automatically ensures that all transparent objects are rendered <em>after</em> opaque objects. If the transparent box was
rendered before the teapot, then the teapot would not be visible because its fragments would have been rejected by the
WebGL <a href="http://en.wikipedia.org/wiki/Z-buffering">depth test</a> because the pixels for the box would already be in the depth buffer,
with closer depth values. Graphics geeks will note that there may be a problem with depth buffer rejection if we have
multiple transparent objects. I’ll address that in the following section on Transparency Sorting.<br /><br /></p>

<p>When designing SceneJS, I had considered just making the <code class="highlighter-rouge">transparent</code> property on <code class="highlighter-rouge">flags</code> nodes true by default.
That way, an <code class="highlighter-rouge">alpha</code> value less than 1.0 would be sufficient to make the box transparent, no <code class="highlighter-rouge">flags</code> node required. However,
   that doesn’t quite fit with alpha mapping (see tutorial on <a href="/articles/scenejs-alpha-mapping">Alpha Maps</a>). We might have an <code class="highlighter-rouge">alpha</code> of 1.0, then
   have an alpha map that modifies it for fragments within the shader, which fails to create transparency for those because SceneJS has already
   determined that the geometry is opaque. That’s one reason we have <code class="highlighter-rouge">flags</code> in the mix, other being that we can use them
   to easily switch transparency on and off for chunks of our scenes.<br /></p>

<h3 id="switching-transparency-on-and-off">Switching transparency on and off</h3>
<p>You can make the box opaque by flipping the <code class="highlighter-rouge">transparent</code> flag on that <code class="highlighter-rouge">flags</code> node:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myScene</span><span class="p">.</span><span class="nx">getNode</span><span class="p">(</span><span class="s2">"myFlags"</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">flags</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">flags</span><span class="p">.</span><span class="nx">setTransparent</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">});</span></code></pre></figure>

<h3 id="varying-opacity">Varying opacity</h3>
<p>You can make the box less transparent my increasing the <code class="highlighter-rouge">alpha</code> on its <code class="highlighter-rouge">material</code> node:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myScene</span><span class="p">.</span><span class="nx">getNode</span><span class="p">(</span><span class="s2">"myMaterial"</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">myMaterial</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">myMaterial</span><span class="p">.</span><span class="nx">setAlpha</span><span class="p">(</span><span class="mf">0.8</span><span class="p">);</span>
    <span class="p">});</span></code></pre></figure>

<h3 id="picking-through-transparent-objects">Picking through transparent objects</h3>
<p>Want to be able to pick the teapot through the box? That’s covered in the
tutorial on <a href="/articles/scenejs-picking/#picking-through-transparent-objects">Picking in SceneJS</a>.
<br /><br /></p>

<h1 id="transparency-sorting">Transparency sorting</h1>

<p>It’s tricky making multiple overlapping transparent objects look good in WebGL. In this section I’ll describe
the problem, some solutions that don’t work so well with WebGL, and a partial solution that SceneJS provides using
prioritised render bins.</p>

<h3 id="the-problem">The problem</h3>

<p>SceneJS renders transparent objects using the standard <a href="http://en.wikipedia.org/wiki/Alpha_compositing">alpha blending technique</a>,
where it combines each transparent object’s translucent colour with the colours of the objects behind it.
<br /><br />
As mentioned earlier, there’s one catch: SceneJS may also be using the depth
buffer’s Z-test to solve visibility for overlapping objects, which works by ensuring that each pixel is written to the colour
buffer only if its Z-depth is closer than any pixel already at the same location.<br /><br />The example below shows the
problem. If we were to render the outer green box first, then when we try to render the inner yellow and blue boxes,
the pixels of those boxes will not be rendered, because their Z-depths are greater than the pixels already rendered for
the outer green box.</p>

<p><br /><br />
<a href="http://scenejs.org/examples.html?page=transparencySorting"><img src="/images/scenejs/transparencySort.jpg" alt="TransparencySort" /></a></p>

<p><a href="http://scenejs.org/examples.html?page=transparencySorting">Run this example</a>.
<br /><br />
We therefore need to order the rendering of the boxes from the innermost box outwards, so that the
pixels of each box don’t get rejected by the depth test, and thus get the chance to be blended with each other in
the colour buffer - a technique called <a href="http://www.opengl.org/wiki/Transparency_Sorting">transparency sorting</a>.
<br /><br /></p>

<h3 id="solutions-that-dont-work-so-well-in-webgl">Solutions that don’t work so well in WebGL</h3>

<p>Algorithms to find that order automatically are simple enough, but not easy to do efficiently on WebGL.</p>

<h4 id="painters-algorithm-or-bsp-nope">Painter’s Algorithm or BSP? Nope.</h4>

<p>Ideally, I would have liked to use the <a href="http://en.wikipedia.org/wiki/Painter's_algorithm">painters algorithm</a>, or a <a href="http://en.wikipedia.org/wiki/Bsp_tree">BSP tree</a>,
which would render all the faces in the scene in order from furthest face first, through to closest face last.
 <br /><br />
Two show stoppers exist with that though:</p>

<ol>
  <li>In WebGL we don’t get that kind of granular access to individual faces. Rendering the faces of a mesh is a batch
 operation, where we bind the vertex arrays for the mesh, then do a draw call to render them in one hit.</li>
  <li>If we <strong>were</strong> able to draw each face individually (like we could back in the days of fixed-function OpenGL), then
  the constant switching of colours and textures for each face would make for some horrendously inefficient GPU state changes.</li>
</ol>

<h4 id="depth-peeling-nope">Depth peeling? Nope.</h4>

<p>I had also considered <a href="http://en.wikipedia.org/wiki/Depth_peeling">depth peeling</a>, which is essentially an order-independent
technique in which you render the scene multiple times, each time clipping the objects to a min-max layer, which you
 move forwards each time. Even though that’s awesome for solving our problem for nested objects, like our boxes, it requires multiple
 passes on the draw list for each frame. That would severely impact SceneJS’ efficiency at rendering large quantities
 of objects, which is a priority feature.
 <br /></p>

<h2 id="solution-ordered-render-bins">Solution: Ordered render bins</h2>

<p>In the end I went for the lowest common denominator and simply allowed you to organise scene objects within <code class="highlighter-rouge">layer</code> nodes.
 These work by manually partitioning the objects into prioritised render bins, ordered so that the objects within the
 <code class="highlighter-rouge">layer</code> with the lowest priority are rendered first.<br /><br />Note that since the <code class="highlighter-rouge">layer</code> node’s priorities can be
 dynamically reassigned, the way is also open to support some sort of automatic object Z-sorting later if needed.
<br /><br />
Let’s have a look at how we use the <code class="highlighter-rouge">layer</code> nodes to render our boxes in the correct order for transparency.
<br /><br />
Here’s the scene that renders the nested boxes in the scene above.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">scene</span> <span class="o">=</span> <span class="nx">SceneJS</span><span class="p">.</span><span class="nx">createScene</span><span class="p">({</span>
    <span class="na">nodes</span><span class="p">:[</span>

        <span class="c1">// Mouse-orbited camera</span>
        <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span><span class="s2">"cameras/orbit"</span><span class="p">,</span> <span class="na">yaw</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="na">pitch</span><span class="p">:</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="na">zoom</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span> <span class="na">zoomSensitivity</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>

            <span class="na">nodes</span><span class="p">:[</span>

                <span class="c1">// Inner opaque blue box.</span>

                <span class="c1">// Rendered first, within layer at priority -1.</span>

                <span class="c1">// Box is opaque because material has default alpha of 1.0, and box</span>
                <span class="c1">// is not wrapped with a flags node with a 'transparent' flag set.</span>

                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span><span class="s2">"layer"</span><span class="p">,</span>
                    <span class="na">priority</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>

                    <span class="na">nodes</span><span class="p">:[</span>
                        <span class="p">{</span>
                            <span class="na">type</span><span class="p">:</span><span class="s2">"material"</span><span class="p">,</span> <span class="na">color</span><span class="p">:{</span> <span class="na">r</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="na">g</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span><span class="mf">1.0</span> <span class="p">},</span>
                            <span class="na">nodes</span><span class="p">:[</span>
                                <span class="p">{</span>
                                    <span class="na">type</span><span class="p">:</span><span class="s2">"scale"</span><span class="p">,</span> <span class="na">x</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="na">z</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                                    <span class="na">nodes</span><span class="p">:[</span>

                                        <span class="c1">// Box primitive</span>
                                        <span class="p">{</span>
                                            <span class="na">type</span><span class="p">:</span><span class="s2">"geometry/box"</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>


                <span class="c1">// Flags around our transparent boxes</span>

                <span class="c1">// Enables to 'alpha' values on the materials around</span>
                <span class="c1">// our boxes to to cause them to be translucent.</span>

                <span class="c1">// Also cull backfaces on those boxes because we can't</span>
                <span class="c1">// control the order in which faces render. We don't want</span>
                <span class="c1">// front faces rendering before back faces, which would</span>
                <span class="c1">// cause the back faces to be rejected by the depth buffer</span>
                <span class="c1">// and deny the opportunity</span>
                <span class="c1">// to blend the faces - easy fix is just to not render the backfaces.</span>

                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span><span class="s2">"flags"</span><span class="p">,</span>
                    <span class="na">flags</span><span class="p">:{</span> <span class="na">transparent</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span> <span class="na">backfaces</span><span class="p">:</span><span class="kc">false</span> <span class="p">},</span>

                    <span class="na">nodes</span><span class="p">:[</span>

                        <span class="c1">// Middle transparent red box</span>

                        <span class="c1">// Rendered next, in implicit layer at priority 0</span>

                        <span class="c1">// We don't actually need this layer because anything</span>
                        <span class="c1">// not within a Anything not in a layer is actually</span>
                        <span class="c1">// at priority 0 implicitly.</span>

                        <span class="c1">// This box is transparent because its wrapped with a</span>
                        <span class="c1">// material having an alpha channel that's less than</span>
                        <span class="c1">// 1.0, which works with the 'transparent' flag.</span>

                        <span class="p">{</span>
                            <span class="na">type</span><span class="p">:</span><span class="s2">"layer"</span><span class="p">,</span>
                            <span class="na">priority</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>

                            <span class="na">nodes</span><span class="p">:[</span>
                                <span class="p">{</span>
                                    <span class="na">type</span><span class="p">:</span><span class="s2">"material"</span><span class="p">,</span>
                                    <span class="na">color</span><span class="p">:{</span> <span class="na">r</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="na">g</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span><span class="mf">0.2</span> <span class="p">},</span>
                                    <span class="na">alpha</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span>

                                    <span class="na">nodes</span><span class="p">:[</span>
                                        <span class="p">{</span>
                                            <span class="na">type</span><span class="p">:</span><span class="s2">"scale"</span><span class="p">,</span> <span class="na">x</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="na">z</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>

                                            <span class="na">nodes</span><span class="p">:[</span>
                                                <span class="p">{</span>
                                                    <span class="na">type</span><span class="p">:</span><span class="s2">"geometry/box"</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">},</span>

                        <span class="c1">// Outer transparent green cube</span>

                        <span class="c1">// Rendered last, within layer with priority 1</span>

                        <span class="c1">// This box is also transparent because its wrapped</span>
                        <span class="c1">// with a material having an alpha channel that's</span>
                        <span class="c1">// less than 1.0, which works with the</span>
                        <span class="c1">// 'transparent' flag.</span>

                        <span class="p">{</span>
                            <span class="na">type</span><span class="p">:</span><span class="s2">"layer"</span><span class="p">,</span>
                            <span class="na">priority</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                            <span class="na">id</span><span class="p">:</span> <span class="s2">"greenBoxLayer"</span><span class="p">,</span>

                            <span class="na">nodes</span><span class="p">:[</span>
                                <span class="p">{</span>
                                    <span class="na">type</span><span class="p">:</span><span class="s2">"material"</span><span class="p">,</span>
                                    <span class="na">color</span><span class="p">:{</span> <span class="na">r</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="na">g</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span><span class="mf">0.2</span> <span class="p">},</span>
                                    <span class="na">alpha</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span>

                                    <span class="na">nodes</span><span class="p">:[</span>
                                        <span class="p">{</span>
                                            <span class="na">type</span><span class="p">:</span><span class="s2">"scale"</span><span class="p">,</span> <span class="na">x</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="na">z</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span>

                                            <span class="na">nodes</span><span class="p">:[</span>
                                                <span class="p">{</span>
                                                    <span class="na">type</span><span class="p">:</span><span class="s2">"geometry/box"</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">});</span></code></pre></figure>

<p>Things to note:</p>

<ul>
  <li>The boxes are wrapped with <code class="highlighter-rouge">layer</code> nodes, with <code class="highlighter-rouge">priority</code> properties set to order their rendering so that the
innermost box renders first</li>
  <li>Anything not within a <code class="highlighter-rouge">layer</code> node is implicitly at priority 0. The <code class="highlighter-rouge">layer</code> around the middle box is therefore
 actually redundant.</li>
</ul>

<h3 id="changing-layer-priorities">Changing layer priorities</h3>
<p>You can change the <code class="highlighter-rouge">priority</code> on the <code class="highlighter-rouge">layer</code> nodes at any time. Let’s change the priority for the green box:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myScene</span><span class="p">.</span><span class="nx">getNode</span><span class="p">(</span><span class="s2">"greenBoxLayer"</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">layer</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">layer</span><span class="p">.</span><span class="nx">setPriority</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">});</span></code></pre></figure>

<p>That’s going to make the green outermost box render before the innermost blue box, which is actually going to wreck our
 transparency sorting.
 <br /><br />
<strong>Performance tip</strong>: changing those priorities causes SceneJS to re-sort its internal display list, so there will be a
performance hit if you do that frequently.</p>

<p><br /></p>

<h1 id="conclusion">Conclusion</h1>

<p>In this tutorial I’ve shown you how to use the <code class="highlighter-rouge">material</code> node in conjunction with <code class="highlighter-rouge">flags</code> nodes to make geometry
   appear transparent. I also touched on the classic problem of making multiple overlapping transparent objects look good,
    and described the partial solutuion provided by SceneJS through its <code class="highlighter-rouge">layer</code> nodes, which order the rendering of geometries
     so that they alpha-blend nicely with one another.
<br /><br /></p>

<h1 id="whats-next">What’s next?</h1>

<ul>
  <li>Learn how to texture your transparency using <a href="/articles/scenejs-alpha-mapping">Alpha Maps</a></li>
</ul>

      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          <img src="/images/avatar.jpg" class="bio-photo" alt="xeolabs bio photo"></a>
<h3><a href="/about/">xeolabs</a></h3>
<p><b>Lindsay Kay</b><br><br><i>3D software engineer / WebGL developer</i></p>
<a href="http://twitter.com/xeographics" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://linkedin.com/in/lindsaystanleykay" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="http://github.com/xeolabs" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>
<br>
<hr>
<p style="text-align: center;"><a href="/pdfs/OpenGLInsights.pdf"><img style="text-align: center; width: 80%;" src="/images/scenejs/OpenGLInsights2.jpg"></a><br>
    <i>My chapter on <a href="http://scenejs.org">SceneJS</a> for OpenGL Insights is now <a href="/pdfs/OpenGLInsights.pdf">free to download!</a></i></p>

        </div>
        <p class="byline"><strong>Transparency in SceneJS</strong> was published on <time datetime="2013-11-03T00:00:00+00:00" itemprop="datePublished">November 03, 2013</time> and last modified on <time datetime="2013-05-31" itemprop="dateModified">May 31, 2013</time> by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name"><a href="/about" title="About xeolabs" itemprop="url">xeolabs</a></span></span>.</p>
      </footer>

        <!---->
        <!--<br><br>-->
        <!--<div id="disqus_thread"></div>-->
        <!--<script type="text/javascript">-->
            <!--/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */-->
            <!--var disqus_shortname = 'xeographics'; // required: replace example with your forum shortname-->

            <!--/* * * DON'T EDIT BELOW THIS LINE * * */-->
            <!--(function() {-->
                <!--var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;-->
                <!--dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';-->
                <!--(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);-->
            <!--})();-->
        <!--</script>-->
        <!--<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->
        <!--<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>-->
        <!---->
    </div><!-- /.article-wrap -->
  </article>

</div><!-- /#main -->


<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/articles">View all articles</a>)</small></h4>
    <ul>
    
      
      
      
      <li><a href="/articles/xeogl-bigmodels" title="Bigger Models in xeogl">Bigger Models in xeogl</a></li>
      
    
      
      
      
    
      
      
      
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    <span>&copy; 2018 xeolabs. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
<!--<script src="/assets/js/vendor/jquery-1.9.1.min.js"></script>-->
<!--<script src="/assets/js/vendor/jquery.gifplayer.js"></script>-->
<!--<link rel="stylesheet" href="/assets/css/gifplayer.css" />-->
<!--<script src="/assets/js/scripts.min.js"></script>-->


<!--<script>-->
    <!--$(document).ready( function(){-->
        <!--$('.gifplayer').gifplayer();-->
    <!--});-->
<!--</script>-->



</body>
</html>
